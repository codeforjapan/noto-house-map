(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{388:function(t,e,r){"use strict";r.r(e),r.d(e,"DEFAULT_ICON_COLOR",(function(){return m})),r.d(e,"default",(function(){return f})),r.d(e,"readCategoryOfFolder",(function(){return v})),r.d(e,"groupByCoordinates",(function(){return y}));var o=r(9),n=r(177),l=r(178),c=(r(26),r(12),r(21),r(30),r(176),r(20),r(35),r(31),r(48),r(110),r(249),r(174)),d=r(416),m="lightgreen",f=function(){function t(){Object(n.a)(this,t),this.updated=void 0,this.markers=void 0}return Object(l.a)(t,[{key:"parse",value:function(t,data,e,r,o){switch(t){case"kml":var n=(new DOMParser).parseFromString(data,"text/xml");return this.loadKMLData(n,e);case"umal":this.loadUmapJsonData(data);break;case"geojson":var l=JSON.parse(data);return this.loadGeoJSONData(l);case"xlsx":return this.loadXLSJsonData(data,r,o)}}},{key:"addFeatureCollection",value:function(t,e){t.features.forEach((function(t){t.geometry.type}))}},{key:"loadUmapJsonData",value:function(data){data.layers.forEach((function(t){}))}},{key:"loadXLSJsonData",value:function(data,t,e){var r=Date.now().toLocaleString(),o=[];return data.forEach((function(r){var n=Object.prototype.hasOwnProperty.call(r,"Latitude")?r.Latitude:Object.prototype.hasOwnProperty.call(r,"緯度")?r.緯度:void 0,l=Object.prototype.hasOwnProperty.call(r,"Longitude")?r.Longitude:Object.prototype.hasOwnProperty.call(r,"経度")?r.経度:void 0;if(void 0!==n&&void 0!==l){r.name=r[e];var c={type:"Feature",properties:r,geometry:{type:"Point",coordinates:[l,n]}},d="未分類";d=c.properties[t]?c.properties[t]:"未分類",o.push({feature:c,category:d})}})),[o,r]}},{key:"loadGeoJSONData",value:function(data){var t=Date.now().toLocaleString(),e=[];return data.features.forEach((function(t){var r="未分類";t.properties.category&&(r=t.properties.category),e.push({feature:t,category:r})})),[e,t]}},{key:"loadKMLData",value:function(data,t){var e=data.getElementsByTagName("Folder");0===e.length&&(e=data.getElementsByTagName("Document"));var r="";if(void 0!==t&&"regexp"===t.type){var o=data.getElementsByTagName(t.field);if(o.length>0){var text=o[0].innerHTML,n=new RegExp(t.pattern,"iu").exec(text);null!=n&&n.length>1&&(r="("+n[t.index]+")")}}var l=[];return Array.prototype.forEach.call(e,(function(t){var e=v(t,data);if("FeatureCollection"===d.kml(t).type){var r=d.kml(t,{styles:!0});if(r.features.length>0)return r.features.map((function(t){return"Point"===t.geometry.type&&(t.properties["marker-color"]=e.color,l.push({feature:t,category:e.name})),t}))}else{var o=d.kml(t,{styles:!0});o.properties["marker-color"]=e.color,l.push({geojsondata:o,category:e.name})}})),[l,r]}},{key:"inBounds",value:function(t,e){var r=(t[0]-e.getNorthEast().lng)*(t[0]-e.getSouthWest().lng)<0,o=(t[1]-e.getNorthEast().lat)*(t[1]-e.getSouthWest().lat)<0;return r&&o}},{key:"convertCategoryStyle",value:function(t,e){return void 0===e||e.forEach((function(e){if(e.name===t.name)return t.color=e.color,t.bgColor=e.bg_color,t.iconClass=e.icon_class,t.class=e.class,t})),t}},{key:"serializeLatLng",value:function(t){return t.lat+","+t.lng}},{key:"serializeBounds",value:function(t){return this.serializeLatLng(t.getNorthWest())+"-"+this.serializeLatLng(t.getSouthEast())}},{key:"deserializeLatLng",value:function(s){var t=s.split(",",2),e=Object(o.a)(t,2),r=e[0],n=e[1],l=parseFloat(n),d=parseFloat(r);return new c.LngLat(l,d)}},{key:"deserializeBounds",value:function(s){try{var t=this;return new c.LngLatBounds(s.split("-",2).map((function(e){return t.deserializeLatLng(e)})))}catch(t){return}}}]),t}();function v(t,e){var r,o="red";try{r=t.getElementsByTagName("name")[0].textContent||"";var n=t.getElementsByTagName("styleUrl")[0].textContent||"";if(n){var l=e.querySelectorAll(n+" Pair");l.length>0&&Array.prototype.forEach.call(l,(function(t){var r=t.querySelector("key");if(r&&"normal"===r.textContent){var n=t.querySelector("styleUrl").textContent,style=e.querySelector(n);try{var l=style.querySelector("IconStyle color").textContent,a=parseInt("0x"+l.substring(0,2))/255,b=parseInt("0x"+l.substring(2,4)),g=parseInt("0x"+l.substring(4,6)),c=parseInt("0x"+l.substring(6,8));o="rgba(".concat(c,",").concat(g,",").concat(b,",").concat(a,")")}catch(t){o=m}}}))}}catch(e){console.log("#category read error"),console.log(e),console.log(t)}return{name:r,color:o,iconUrl:undefined}}function y(data){var t={};return data.forEach((function(e){var r=e.feature.geometry.coordinates.join(","),o={"管理番号":e.feature.properties["管理番号"],"階数":e.feature.properties["階数"],"部屋番号":e.feature.properties["部屋番号"],"家賃":e.feature.properties["家賃（円）"],"間取り":e.feature.properties["間取り"],"ペット 可否":e.feature.properties["ペット 可否"],"駐車料":e.feature.properties["駐車料（円）"]};if(t[r])t[r].feature.properties.rooms.push(o);else{var n=JSON.parse(JSON.stringify(e));n.feature.properties.rooms=[o],delete n.feature.properties["管理番号"],delete n.feature.properties["階数"],delete n.feature.properties["部屋番号"],delete n.feature.properties["家賃（円）"],delete n.feature.properties["間取り"],delete n.feature.properties["ペット 可否"],delete n.feature.properties["駐車料（円）"],t[r]=n}})),Object.values(t)}},439:function(t,e,r){"use strict";r.r(e);r(30),r(48),r(41),r(402),r(12);var o,n=r(9),l=r(6),c=(r(58),r(25),r(405),r(407),r(31),r(55),r(59),r(21),r(138),r(26),r(35),r(384),r(385),r(174)),d=r.n(c),m=r(383),f=r(410).crc16,v={props:{mapConfig:{type:Object,required:!0}},data:function(){var t="en";return"ja"===this.$i18n.locale&&(t="ja"),{layers:[],map:null,bounds:null,updated_at:null,previous_hash:"",activeCategory:"",checkedArea:[],isOpenAreaSelect:!1,isOpenList:!1,isDisplayAllCategory:!0,mapStyle:"https://tile.openstreetmap.jp/styles/maptiler-basic-ja/style.json",legendMark:r(386)("./fukidashi_obj_".concat(t,".svg")),legendActive:r(387)("./active_txt_".concat(t,".svg"))}},computed:{center:function(){return this.mapConfig.center},setLayerSettings:function(t,e,r,o){var n=this.mapConfig;return n.layer_settings[t]={color:e,bg_color:r},o&&(n.layer_settings[t].icon_class=o),this.$emit("update:mapConfig",n),n},inBoundsMarkers:function(){var t=this,e=this.layers.filter((function(e){return e.source.show&&t.checkedArea.includes(e.source.title)})).map((function(t){return t.markers})).flat().filter((function(marker){return!t.bounds||o.inBounds(marker.feature.geometry.coordinates,t.bounds)}));return e},displayMarkersGroupByCategory:function(){return this.inBoundsMarkers.reduce((function(t,e){return e.feature.properties.rooms.map((function(t){return{category:e.category,feature:e.feature,room:t}})).forEach((function(e){var r=t.find((function(g){return g.category===e.category}));r||(r={category:e.category,prop:e.category,markers:[]},t.push(r)),r.markers.push(e)})),t}),[])},selectArea:{get:function(){return this.checkedArea},set:function(t){this.checkedArea=t}}},mounted:function(){var t=this,e=r(388).default,c=r(388).groupByCoordinates,d=new(0,r(390).default);o=new e;var area=[],v={},y=this;this.mapConfig.sources.forEach((function(source){Object(l.a)(regeneratorRuntime.mark((function e(){var data,r,l,h,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return source.show&&area.push(source.title),y.checkedArea=area,y.updated_at=Object(m.a)(new Date),e.next=5,d.load(source);case 5:data=e.sent,console.log(source),r=o.parse(source.type,data,source.updated_search_key,source.categoryColumn,source.nameColumn),l=Object(n.a)(r,2),h=l[0],C=l[1],console.log(h),h.map((function(marker){v[marker.category]=!0})),source.updated_at=C,Object.keys(v).map((function(e){if(!y.mapConfig.layer_settings[e]){var r="#";r+=(parseInt(f(e.substr(0)),16)%32+64).toString(16),r+=(parseInt(f(e.substr(1)),16)%32+64).toString(16),r+=(parseInt(f(e.substr(2)),16)%32+64).toString(16);var o="#";o+=(parseInt(f(e.substr(0)),16)%32+128).toString(16),o+=(parseInt(f(e.substr(1)),16)%32+128).toString(16),o+=(parseInt(f(e.substr(2)),16)%32+128).toString(16),t.$emit("setLayerSettings",{name:e,color:r,bg_color:o})}})),y.layers.push({source:source,markers:c(h)});case 13:case"end":return e.stop()}}),e)})))()}))},methods:{load:function(){var t=window.location.hash.substr(1),e=o.deserializeBounds(t);this.map=this.$refs.map_obj,(void 0!==e||void 0!==(e=o.deserializeBounds(this.mapConfig.default_hash)))&&this.map.map.fitBounds(e,{linear:!1}),this.map.map.on("moveend",this.etmitBounds),this.etmitBounds(),this.map.map.addControl(new d.a.NavigationControl)},etmitBounds:function(){this.bounds=this.map.map.getBounds(),this.setHash(this.bounds),this.$emit("bounds-changed")},setHash:function(t){var s=o.serializeBounds(t),path=location.pathname;s!==this.previous_hash&&window.history.pushState("","",path+"#"+s),this.previous_hash=s},selectCategory:function(t){this.activeCategory=t},clickPrintButton:function(){window.print()},getMarkerCategoryText:function(t,e){void 0===t&&(t="未分類");var r="category."+t,o=this.$i18n.t(r);return o!==r?o:t},getMarkerNameText:function(t,e){var r=t.name;return t.hasOwnProperty("name:"+e)&&(r=t["name:"+e]),r},findNumbersOfMarker:function(t,marker){for(var i=0;i<t.length;i++){var e=t[i];if(e.feature.geometry.coordinates[0]===marker.feature.geometry.coordinates[0]&&e.feature.geometry.coordinates[1]===marker.feature.geometry.coordinates[1])return i+1}return 0}}},y=r(37),h=Object(y.a)(v,(function(){var t=this,e=t._self._c;return e("div",[e("client-only",[t.layers.length?e("div",[e("div",{staticClass:"map-outer"},[e("MglMap",{ref:"map_obj",attrs:{mapStyle:t.mapStyle,center:t.center,zoom:15,preserveDrawingBuffer:"",sourceId:"basemap",id:"map"},on:{"update:mapStyle":function(e){t.mapStyle=e},"update:map-style":function(e){t.mapStyle=e},load:t.load}},[e("MglGeolocateControl"),t._l(t.inBoundsMarkers,(function(marker,r){var o,n,l,c,d,m,f,v,y;return e("MglMarker",{key:String(r),attrs:{coordinates:marker.feature.geometry.coordinates,anchor:"top-left"}},[e("template",{slot:"marker"},[e("div",{staticClass:"marker"},[e("span",{class:{show:t.isDisplayAllCategory||t.activeCategory===marker.category},style:{background:(null===(o=t.mapConfig.layer_settings[marker.category])||void 0===o?void 0:o.color)||marker.feature.properties["marker-color"]||"red"}},[e("i",{class:[null===(n=t.mapConfig.layer_settings[marker.category])||void 0===n?void 0:n.icon_class,null===(l=t.mapConfig.layer_settings[marker.category])||void 0===l?void 0:l.class],style:{backgroundColor:null===(c=t.mapConfig.layer_settings[marker.category])||void 0===c?void 0:c.color,display:t.mapConfig.layer_settings[marker.category]?"inline":"none"}}),e("b",{staticClass:"number",style:{background:null===(d=t.mapConfig.layer_settings[marker.category])||void 0===d?void 0:d.bg_color}},[t._v(t._s(r+1))])])])]),e("MglPopup",[e("div",{staticClass:"popup-window"},[e("div",{staticClass:"popup-type"},[e("i",{class:[null===(m=t.mapConfig.layer_settings[marker.category])||void 0===m?void 0:m.icon_class,null===(f=t.mapConfig.layer_settings[marker.category])||void 0===f?void 0:f.class],style:{backgroundColor:null===(v=t.mapConfig.layer_settings[marker.category])||void 0===v?void 0:v.color}}),e("span",{staticClass:"popup-poi-type"},[t._v(t._s(t.getMarkerCategoryText((null===(y=t.mapConfig.layer_settings[marker.category])||void 0===y?void 0:y.name)||marker.category,t.$i18n.locale)))])]),e("p",{staticClass:"popup-detail"},[t._v(t._s(t.$i18n.t("PrintableMap.name"))+" "),marker.feature.properties.rooms.length>1?e("span",[t._v(t._s(t.getMarkerNameText(marker.feature.properties,t.$i18n.locale)))]):e("span",[e("nuxt-link",{attrs:{to:t.localePath("/detail/".concat(marker.feature.properties.rooms[0]["管理番号"]))}},[t._v(t._s(t.getMarkerNameText(marker.feature.properties,t.$i18n.locale)))])],1)]),t._l(marker.feature.properties.rooms,(function(r){return e("div",{staticClass:"list-item grid-noGutter"},[e("div",{staticClass:"col-4"},[e("nuxt-link",{attrs:{to:t.localePath("/detail/".concat(r["管理番号"]))}},[e("span",{staticClass:"item-name"},[t._v(t._s("-"===r["部屋番号"]?"詳細":r["部屋番号"]))])])],1),e("div",{staticClass:"col-4"},[e("span",{staticClass:"item-price"},[t._v(t._s(r["間取り"]))])]),e("div",{staticClass:"col-4"},[e("span",{staticClass:"item-price"},[t._v(t._s(r["家賃"]))])])])}))],2)])],2)}))],2)],1),e("div",{staticClass:"legend-navi"},[e("div",{staticClass:"area-select",class:{open:t.isOpenAreaSelect}},[e("div",{staticClass:"area-close",on:{click:function(e){t.isOpenAreaSelect=!1}}},[t._v(t._s(t.$t("PrintableMap.close_area_select"))),e("i",{staticClass:"fas fa-arrow-down"})]),e("div",{staticClass:"area-list-outer",class:{open:t.isOpenAreaSelect}},[e("ul",{staticClass:"area-list grid"},t._l(t.mapConfig.sources,(function(source){return e("li",{staticClass:"area-item col-12_xs-6"},[e("label",{staticClass:"area-label"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectArea,expression:"selectArea"}],staticClass:"area-input",attrs:{type:"checkbox"},domProps:{value:source.title,checked:Array.isArray(t.selectArea)?t._i(t.selectArea,source.title)>-1:t.selectArea},on:{change:function(e){var r=t.selectArea,o=e.target,n=!!o.checked;if(Array.isArray(r)){var l=source.title,c=t._i(r,l);o.checked?c<0&&(t.selectArea=r.concat([l])):c>-1&&(t.selectArea=r.slice(0,c).concat(r.slice(c+1)))}else t.selectArea=n}}}),t._v(t._s(source.title)),e("span",[t._v(t._s(source.updated_at))]),source.link?e("a",{attrs:{href:source.link,target:"blank"}},[t._v("["+t._s(t.$t("PrintableMap.back_to_map"))+"]")]):t._e()])])})),0)])]),e("div",{staticClass:"navigation"},[e("div",{staticClass:"navigation-area print-exclude"},[e("div",{staticClass:"legend-navi-icon active"},[e("div",{staticClass:"legend-navi-button print-button",on:{click:function(e){return t.clickPrintButton()}}},[e("span",{staticClass:"fa fa-print",attrs:{alt:t.$t("PrintableMap.print")}})])])]),e("div",{staticClass:"navigation-legend legend-navi-inner print-exclude"},[e("div",{staticClass:"legend-navi-icon"},[e("img",{attrs:{src:t.legendMark,width:"60",height:"60",alt:t.$t("PrintableMap.legend")}})]),e("div",{staticClass:"legend-list-outer"},[e("simplebar",{attrs:{"data-simplebar-auto-hide":"false"}},[e("ul",{staticClass:"legend-list"},t._l(t.mapConfig.layer_settings,(function(r,o){return t.displayMarkersGroupByCategory.some((function(t){return t.category===o}))?e("li",{staticClass:"legend-item"},[e("span",{staticClass:"legend-mark",class:{open:t.isDisplayAllCategory||t.activeCategory===o},style:{backgroundColor:r.color},on:{click:function(e){t.selectCategory(o),t.isOpenList=o,t.isDisplayAllCategory=!1}}},[e("i",{class:[r.icon_class]})])]):t._e()})),0)])],1),e("div",{staticClass:"legend-navi-icon",class:{active:t.activeCategory},on:{click:function(e){t.selectCategory(""),t.isDisplayAllCategory=!0,t.isOpenList=!0}}},[e("div",{staticClass:"legend-navi-button"},[e("img",{staticClass:"legend-navi-img",attrs:{src:t.legendActive,width:"40",height:"40",alt:t.$t("PrintableMap.show_all")}})])])])]),e("div",{staticClass:"list-outer",class:{open:t.isOpenList}},[t._l(t.displayMarkersGroupByCategory,(function(r){var o,n,l,c;return e("section",{staticClass:"list-section",class:{show:t.isDisplayAllCategory||t.activeCategory===t.getMarkerCategoryText(r.category,t.$i18n.locale)}},[e("h2",{staticClass:"list-title",style:{backgroundColor:(null===(o=t.mapConfig.layer_settings[r.category])||void 0===o?void 0:o.color)||(null===(n=r.markers[0])||void 0===n||null===(n=n.feature)||void 0===n?void 0:n.properties["marker-color"])||"darkgreen"}},[e("span",{staticClass:"list-title-mark"},[e("i",{class:null===(l=t.mapConfig.layer_settings[r.category])||void 0===l?void 0:l.icon_class})]),e("span",[t._v(t._s(t.getMarkerCategoryText((null===(c=t.mapConfig.layer_settings[r.category])||void 0===c?void 0:c.name)||r.category,t.$i18n.locale)))])]),e("ul",{staticClass:"list-items"},[e("li",{staticClass:"list-item-header grid-noGutter"},[e("div",{staticClass:"col-1"},[e("div",{staticClass:"span"},[t._v("No.")])]),e("div",{staticClass:"col-3"},[e("div",{staticClass:"span"},[t._v("物件名")])]),e("div",{staticClass:"col-2"},[e("div",{staticClass:"span"},[t._v("間取り")])]),e("div",{staticClass:"col-2"},[e("div",{staticClass:"span"},[t._v("家賃")])]),e("div",{staticClass:"col-2"},[e("div",{staticClass:"span"},[t._v("ペット")])]),e("div",{staticClass:"col-2"},[e("div",{staticClass:"span"},[t._v("駐車料")])])]),t._l(r.markers,(function(marker,r){return e("li",{staticClass:"list-item grid-noGutter",class:{oddlist:r%2==0}},[e("div",{staticClass:"col-1"},[e("span",{staticClass:"item-number"},[t._v(t._s(t.findNumbersOfMarker(t.inBoundsMarkers,marker)))])]),e("div",{staticClass:"col-3"},[e("nuxt-link",{attrs:{to:t.localePath("/detail/".concat(marker.room["管理番号"]))}},[e("span",{staticClass:"item-name"},[t._v(t._s(t.getMarkerNameText(marker.feature.properties,t.$i18n.locale))+" "+t._s(marker.room["部屋番号"]))])])],1),e("div",{staticClass:"col-2"},[e("span",{staticClass:"item-price"},[t._v(t._s(marker.room["間取り"]))])]),e("div",{staticClass:"col-2"},[e("span",{staticClass:"item-price"},[t._v(t._s(marker.room["家賃"]))])]),e("div",{staticClass:"col-2"},[e("span",{staticClass:"item-pet"},[t._v(t._s(marker.room["ペット 可否"]))])]),e("div",{staticClass:"col-2"},[e("span",{staticClass:"item-parking"},[t._v(t._s(marker.room["駐車料"]))])])])}))],2)])})),t.isDisplayAllCategory&&0===t.displayMarkersGroupByCategory.length?e("div",{staticClass:"list-section-none"},[e("p",[t._v(t._s(t.$t("PrintableMap.no_point_in_map")))])]):t._e()],2)]),e("div",{staticClass:"legend-close print-exclude",class:{open:t.isOpenList},on:{click:function(e){t.isOpenList=!1}}},[t._v(t._s(t.$t("PrintableMap.close_list"))),e("i",{staticClass:"fas fa-arrow-down"})])]):t._e()])],1)}),[],!1,null,null,null).exports,C=r(400),_=r(401);r(399).init();var k={components:{PrintableMap:h,Modal:_.a,MyHeader:C.a},asyncData:function(t){var e=t.app.i18n.locale;return{updated_at:Object(m.a)(new Date,e)}},data:function(){return{mapConfig:r(381),locale:null,isOpenExplain:!1,fullURL:null,updated_at:null}},head:function(){var title,t,image=this.mapConfig.map_image?this.mapConfig.map_image:"logo.png";if("ja"===this.$i18n.locale)title=this.mapConfig.map_title,t=this.mapConfig.map_description;else title=this.mapConfig.map_title_en,t=this.mapConfig.map_description_en;return{title:title+" - "+this.$i18n.t("common.site_name"),meta:[{hid:"description",name:"description",content:t},{hid:"og:image",property:"og:image",content:"https://kamimap.com/images/"+image},{hid:"og:description",name:"og:description",content:t},{hid:"og:title",name:"og:title",content:title+this.$i18n.t("common.site_name")}]}},methods:{updateQRCode:function(){this.$refs.myHeader.updateQRCode()},closeModalMethod:function(){this.isOpenExplain=!1}}},w=Object(y.a)(k,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"layout-map"},[e("div",{staticClass:"layout-map-inner"},[e("main",{staticClass:"main col-12_md-9_xl-6"},[e("div",{staticClass:"main-sheet"},[e("my-header",{ref:"myHeader",attrs:{mapConfig:t.mapConfig}}),t.mapConfig?e("printable-map",{attrs:{mapConfig:t.mapConfig},on:{"bounds-changed":t.updateQRCode}}):t._e(),e("footer",{staticClass:"footer"},[e("div",{staticClass:"footer-logo"},[e("img",{attrs:{src:r(382),width:"895",height:"160",alt:t.$t("common.title")}})])])],1)])]),e("modal",{attrs:{isOpen:t.isOpenExplain},on:{closeModal:t.closeModalMethod}})],1)}),[],!1,null,null,null);e.default=w.exports}}]);